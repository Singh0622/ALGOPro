{% extends "base.html" %}

{% block title %}Practice Problems - DSA Master{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold mb-3">üíª Practice Problems</h1>
            <p class="lead text-muted">Master DSA with curated LeetCode problems organized by topic and difficulty</p>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">üîç Search Problems</label>
                            <input type="text" class="form-control" id="search-input" placeholder="Search by title or concept...">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üìÇ Category</label>
                            <select class="form-select" id="category-filter">
                                <option value="all">All Categories</option>
                                {% set categories = problems|map(attribute='category')|unique|list %}
                                {% for category in categories|sort %}
                                <option value="{{ category }}">{{ category }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label fw-bold">üìä Difficulty</label>
                            <select class="form-select" id="difficulty-filter">
                                <option value="all">All Difficulties</option>
                                <option value="Easy">Easy</option>
                                <option value="Medium">Medium</option>
                                <option value="Hard">Hard</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label class="form-label fw-bold">üîÑ Reset</label>
                            <button class="btn btn-outline-secondary w-100" onclick="resetFilters()">Clear Filters</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Bar -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center bg-light p-3 rounded">
                <span class="text-muted">Showing <strong id="problem-count">{{ problems|length }}</strong> problems</span>
                <div class="d-flex gap-3">
                    <span class="badge bg-success fs-6">Easy: <span id="easy-count">0</span></span>
                    <span class="badge bg-warning fs-6">Medium: <span id="medium-count">0</span></span>
                    <span class="badge bg-danger fs-6">Hard: <span id="hard-count">0</span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Problems Grid -->
    <div class="row g-4" id="problems-container">
        {% for problem in problems %}
        <div class="col-md-6 col-lg-4 problem-card" 
             data-category="{{ problem.category }}" 
             data-difficulty="{{ problem.difficulty }}"
             data-title="{{ problem.title|lower }}"
             data-concepts="{{ problem.concepts|join(' ')|lower }}">
            <div class="card h-100 border-0 shadow-sm hover-card">
                <div class="card-header d-flex justify-content-between align-items-center bg-white border-bottom-0 pt-3">
                    <span class="badge {% if problem.difficulty == 'Easy' %}bg-success{% elif problem.difficulty == 'Medium' %}bg-warning text-dark{% else %}bg-danger{% endif %}">
                        {{ problem.difficulty }}
                    </span>
                    <span class="text-muted small">#{{ problem.id }}</span>
                </div>
                <div class="card-body">
                    <h5 class="card-title fw-bold mb-2">{{ problem.title }}</h5>
                    <p class="text-muted small mb-3">
                        <i class="bi bi-folder"></i> {{ problem.category }}
                    </p>
                    
                    <div class="concepts-section mb-3">
                        {% for concept in problem.concepts %}
                        <span class="badge bg-light text-dark border me-1 mb-1">{{ concept }}</span>
                        {% endfor %}
                    </div>
                </div>
                <div class="card-footer bg-white border-top-0 pb-3">
                    <a href="{{ problem.link }}" target="_blank" class="btn btn-primary w-100">
                        Solve on LeetCode ‚Üó
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="row d-none">
        <div class="col-12 text-center py-5">
            <div class="display-1 mb-3">üîç</div>
            <h3>No problems found</h3>
            <p class="text-muted">Try adjusting your filters or search query</p>
            <button class="btn btn-primary" onclick="resetFilters()">Clear All Filters</button>
        </div>
    </div>
</div>

<!-- Quick Stats Section -->
<div class="container mt-5 mb-5">
    <div class="row">
        <div class="col-12">
            <h3 class="text-center mb-4">üìà Progress Tracking</h3>
        </div>
    </div>
    <div class="row g-4 text-center">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="display-5 text-primary fw-bold" id="total-solved">0</div>
                <div class="text-muted">Solved</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="display-5 text-warning fw-bold" id="total-attempted">0</div>
                <div class="text-muted">Attempted</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="display-5 text-success fw-bold" id="streak-count">0</div>
                <div class="text-muted">Day Streak</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm p-3">
                <div class="display-5 text-info fw-bold" id="completion-rate">0%</div>
                <div class="text-muted">Completion</div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    updateStats();
    updateDifficultyCounts();
    
    // Search functionality
    document.getElementById('search-input').addEventListener('input', filterProblems);
    document.getElementById('category-filter').addEventListener('change', filterProblems);
    document.getElementById('difficulty-filter').addEventListener('change', filterProblems);
});

function filterProblems() {
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    const selectedCategory = document.getElementById('category-filter').value;
    const selectedDifficulty = document.getElementById('difficulty-filter').value;
    
    const cards = document.querySelectorAll('.problem-card');
    let visibleCount = 0;
    
    cards.forEach(card => {
        const title = card.getAttribute('data-title');
        const concepts = card.getAttribute('data-concepts');
        const category = card.getAttribute('data-category');
        const difficulty = card.getAttribute('data-difficulty');
        
        const matchesSearch = title.includes(searchTerm) || concepts.includes(searchTerm);
        const matchesCategory = selectedCategory === 'all' || category === selectedCategory;
        const matchesDifficulty = selectedDifficulty === 'all' || difficulty === selectedDifficulty;
        
        if (matchesSearch && matchesCategory && matchesDifficulty) {
            card.classList.remove('d-none');
            visibleCount++;
        } else {
            card.classList.add('d-none');
        }
    });
    
    // Update count
    document.getElementById('problem-count').textContent = visibleCount;
    
    // Show/hide no results message
    const noResults = document.getElementById('no-results');
    if (visibleCount === 0) {
        noResults.classList.remove('d-none');
    } else {
        noResults.classList.add('d-none');
    }
}

function resetFilters() {
    document.getElementById('search-input').value = '';
    document.getElementById('category-filter').value = 'all';
    document.getElementById('difficulty-filter').value = 'all';
    filterProblems();
}

function updateDifficultyCounts() {
    const cards = document.querySelectorAll('.problem-card');
    let easy = 0, medium = 0, hard = 0;
    
    cards.forEach(card => {
        const difficulty = card.getAttribute('data-difficulty');
        if (difficulty === 'Easy') easy++;
        else if (difficulty === 'Medium') medium++;
        else if (difficulty === 'Hard') hard++;
    });
    
    document.getElementById('easy-count').textContent = easy;
    document.getElementById('medium-count').textContent = medium;
    document.getElementById('hard-count').textContent = hard;
}

function updateStats() {
    // These would ideally come from localStorage or backend
    // For now, showing placeholder functionality
    const solved = localStorage.getItem('solved_problems') ? JSON.parse(localStorage.getItem('solved_problems')).length : 0;
    const attempted = localStorage.getItem('attempted_problems') ? JSON.parse(localStorage.getItem('attempted_problems')).length : 0;
    const total = document.querySelectorAll('.problem-card').length;
    
    document.getElementById('total-solved').textContent = solved;
    document.getElementById('total-attempted').textContent = attempted;
    document.getElementById('completion-rate').textContent = total > 0 ? Math.round((solved / total) * 100) + '%' : '0%';
    
    // Calculate streak (simplified - would need date tracking in production)
    const streak = localStorage.getItem('streak') || 0;
    document.getElementById('streak-count').textContent = streak;
}

// Function to mark problem as solved (can be called from console or extended with UI)
function markSolved(problemId) {
    let solved = localStorage.getItem('solved_problems') ? JSON.parse(localStorage.getItem('solved_problems')) : [];
    if (!solved.includes(problemId)) {
        solved.push(problemId);
        localStorage.setItem('solved_problems', JSON.stringify(solved));
        updateStats();
    }
}

// Function to mark problem as attempted
function markAttempted(problemId) {
    let attempted = localStorage.getItem('attempted_problems') ? JSON.parse(localStorage.getItem('attempted_problems')) : [];
    if (!attempted.includes(problemId)) {
        attempted.push(problemId);
        localStorage.setItem('attempted_problems', JSON.stringify(attempted));
        updateStats();
    }
}
</script>

<style>
.hover-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
}

.concepts-section {
    min-height: 60px;
}

.problem-card {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
{% endblock %}